---
title: "DATA 550 Final Project: Homework 2"
author: "Leshan Zhao"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Required Libraries
This project requires the folling libaries:
```{r, message=FALSE}
# Install Required package
for (package in c("here", 
                  "knitr", 
                  "dplyr",
                  "ggplot2")){
  if (!requireNamespace(package, quietly = TRUE)) {
    install.packages(package)
  }
}
  
library(here)
library(knitr)
library(ggplot2)
library(dplyr)

```

# Introduction

This analysis utilizes the Cirrhosis Prediction Dataset obtained from Kaggle, containing 18 clinical features used to predict the survival state of patients with liver cirrhosis. The dataset was created to analyze the effects of prolonged liver damage, which often results from conditions such as hepatitis or chronic alcohol consumption. This study aims to explore the relationships between clinical variables and patient survival outcomes, as well as to identify key predictors for liver cirrhosis stage.

The dataset includes patients from a Mayo Clinic study on primary biliary cirrhosis (PBC) of the liver, carried out from 1974 to 1984. During 1974 to 1984, 424 PBC patients referred to the Mayo Clinic qualified for the randomized placebo-controlled trial testing the drug D-penicillamine. Of these, the initial 312 patients took part in the trial and have mostly comprehensive data. The remaining 112 patients didn't join the clinical trial but agreed to record basic metrics and undergo survival tracking. Six of these patients were soon untraceable after their diagnosis, leaving data for 106 of these individuals in addition to the 312 who were part of the randomized trial.
Our primary objective is to understand the impact of various clinical features on patient outcomes, particularly in terms of survival and cirrhosis progression.

# Data Description:
### The following data preprocessing had been performed:
- Drop all the rows where miss value (NA) were present in the Drug column
- Impute missing values with mean results
- One-hot encoding for all category attributes

### Detailed Description of each variable:
1) ID: unique identifier
2) N_Days: number of days between registration and the earlier of death, transplantation, or study analysis time in July 1986
3) Status: status of the patient C (censored), CL (censored due to liver tx), or D (death)
4) Drug: type of drug D-penicillamine or placebo
5) Age: age in [days]
6) Sex: M (male) or F (female)
7) Ascites: presence of ascites N (No) or Y (Yes)
8) Hepatomegaly: presence of hepatomegaly N (No) or Y (Yes)
9) Spiders: presence of spiders N (No) or Y (Yes)
10) Edema: presence of edema N (no edema and no diuretic therapy for edema), S (edema present without diuretics, or edema resolved by diuretics), or Y (edema despite diuretic therapy)
11) Bilirubin: serum bilirubin in [mg/dl]
12) Cholesterol: serum cholesterol in [mg/dl]
13) Albumin: albumin in [gm/dl]
14) Copper: urine copper in [ug/day]
15) Alk_Phos: alkaline phosphatase in [U/liter]
16) SGOT: SGOT in [U/ml]
17) Triglycerides: triglicerides in [mg/dl]
18) Platelets: platelets per cubic [ml/1000]
19) Prothrombin: prothrombin time in seconds [s]
20) Stage: histologic stage of disease (1, 2, 3, or 4)




### Load Data
```{r load-data}
here::i_am("Data550_FinalProject.Rmd")
projDir = here::here()
setwd(projDir)
df = read.csv("data/cirrhosis.csv")
# Display the first few rows of the dataset
head(df)
```

### Table: Descriptive Statistics
The following table provides an overview of the clinical features present in the dataset, including demographic details like age and sex, and clinical markers such as bilirubin, albumin, and cholesterol levels. 

Numeric Variables
```{r}
# Separate numeric (continuous/count) and categorical variables
categorical_vars <- df %>% select_if(~!is.numeric(.))
numeric_vars <- df %>% select_if(is.numeric)

# Create summary tables
numeric_summary <- sapply(numeric_vars, function(x) {
  c(
    mean = round(mean(x, na.rm = TRUE),1),
    min = round(min(x, na.rm = TRUE),1),
    median = round(median(x, na.rm = TRUE),1),
    max = round(max(x, na.rm = TRUE),1),
    n_NAs = round(sum(is.na(x)),1)
  )
})
# Display the summary tables in a well-formatted manner
kable(numeric_summary, caption = "Summary of Numeric Clinical Features in Cirrhosis Prediction Dataset")
```

Categorical Variables
```{r}
categorical_summary <- lapply(categorical_vars, function(x) {
  as.data.frame(table(x))
})

combined_categorical_summary <- do.call(rbind, categorical_summary)
kable(combined_categorical_summary)
```


# Figures

### Distribution of Age by Survival State
The following figure illustrates the distribution of patient age across different survival states. 

From this box plot, we can find that the median ages across the three survival states are similar, roughly between 19,000 and 20,000 days.
The age distribution in the "CL" state is somewhat narrower compared to the "C" and "D" states, suggesting a more concentrated age range in this state. Besides, the age distributions in the "C" and "D" states are broader with similar interquartile ranges, indicating greater age variability in these states. Overall, there is some overlap in the age distributions across the three states, suggesting that age may not be the sole or most critical factor distinguishing these conditions.
```{r}
# Boxplot showing age distribution by survival state
ggplot(df, aes(x = Status, y = Age)) +
  geom_boxplot() +
  labs(title = "Age Distribution by Survival State",
       x = "Survival State",
       y = "Age (Days)")

```

### More: Histograms of N_Days and Age
```{r histograms, fig.width=7, fig.height=5, message=FALSE}
# Histogram of N_Days
ggplot(df, aes(x = N_Days)) +
  geom_histogram(binwidth = 100,  color = "black", alpha = 0.7) +
  labs(title = "Histogram of N_Days",
       x = "Number of Days",
       y = "Frequency")

# Histogram of Age
ggplot(df, aes(x = Age)) +
  geom_histogram(binwidth = 500, color = "black", alpha = 0.7) +
  labs(title = "Histogram of Age",
       x = "Age (Days)",
       y = "Frequency")
```



This initial analysis presents an overview of the Cirrhosis Prediction Dataset and provides some preliminary insights into patient demographics and outcomes. In subsequent analyses, we will further explore the relationships between different clinical features and their impact on survival and cirrhosis progression.